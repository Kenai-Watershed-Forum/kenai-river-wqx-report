```{=html}
<style type="text/css">
details:hover { cursor: pointer }
</style>
```
---
author: "Benjamin Meyer, Kenai Watershed Forum"
date: "`r Sys.Date()`"
output: html_document:
  code_folding: hide
---

# (APPENDIX) Appendix {.unnumbered}

# Appendix: Data Uplift to EPA WQX

## Introduction

Prior to analysis and interpretation of water quality data, we will ensure that all data that meets QA/QC standards outlined in the project Quality Assurance Project Plan (QAPP) [@kenaiwatershedforum2020] is accessible in the appropriate repository. Water quality data for this project is ultimately destined for the EPA Water Quality Exchange (EPA WQX), formerly EPA STORET.

Section B10 of the 2020 QAPP describes data management details and responsible parties for each step of the data pipeline from observation to repository.

### 2021 Water Quality Data

Water quality data generated from the Kenai River Baseline Water Quality Monitoring (KRBWQM) program was submitted to the Soldotna office of the Alaska Department of Environmental Conservation (ADEC) in January 2022 using the project-specific AQWMS Template provided by ADEC.

A crip

#### 2021 Water Quality Data AQWMS Formatting

The code script below assembles water quality data from the three analytic laboratories that partnered with Kenai Watershed Forum for this project in 2021:

-   SGS Laboratories (Anchorage, AK)

-   Soldotna Wastewater Treatment Plant (Soldotna, AK)

-   Taurianen Engineering (Soldotna, AK)

<details>

<summary>

Show Code Below

</summary>

```{r, 2021 AQWMS formatting, eval = F}

# clear environment

# load packages
library(tidyverse)
library(readxl)
library(openxlsx)
library(data.table)

# SGS data
## Reformat SGS data downloaded from their server client (SGS Engage) to match AQWMS template

### spring 2021 SGS data

#### read in results downloaded from SGS 
sgs21 <- read_excel("other/input/2021_wqx_data/spring_2021_wqx_data/SGS/Spring 2021 Results from SGS.xlsx", sheet = "Report", skip = 4)


# upon visual inspection, we can see that the location names in the AQWMS template differ slightly from the place names in the SGS report (spelling and name inconsistencies). To address this, we will manually generate a match table csv file that we can use to rectify

# generate list of unique site names from 2021 SGS data
sgs21_sitenames <- data.table(unique(sgs21$`Client Sample`)) %>%
  # filter out names containing the suffixes "DUP" (duplicate) or Diss/Dis (Dissolved metals sample)
  filter(!grepl(c("Diss|Dis|DUP"),V1)) %>%
  rename("sgs_sitenames" = "V1")

# generate list of unique site names from 2021 AQWMS template
aqwms21_sitenames <- read_excel("other/input/AQWMS/AWQMS_KWF_Baseline_2021.xlsx", sheet = "Monitoring Locations") %>%
  select("Monitoring Location Name") %>%
  distinct()

# write 2021 sgs site names to an excel file
site_match_table_path <- "other/input/AQWMS/site_names_matching_table.xlsx"
write.xlsx(sgs21_sitenames, site_match_table_path) 

#
wb <- loadWorkbook(site_match_table_path)
addWorksheet(wb,"Sheet2")
writeData(wb,"Sheet2",aqwms21_sitenames)
saveWorkbook(wb,site_match_table_path,overwrite = TRUE)


#### working here 1/27/2022

### 1st step:::: make sure that monitoring list locations matches those currently match those in DEC AQWMS database (AWQMS public login: https://awqms2.goldsystems.com/Login.aspx, username akpublic, no password)







# Taurianen data
## Reformat Taurianen data to match AQWMS template

# Soldotna Wastewater Treatment Plant
## Reformat SWWTP data to match AQWMS template


```

</details>

```{r, notes, include = F}

# course of action

# uplift 2021 data

# audit existing data in WQX

# confirm with DEC that they are addressing data 2017 - 2020

# attempt to download missing data from  AQWMS, then upload to EPA WQX

# if not available, reshape data from shared drive to uplift to EPA WQX (big task)

```

<br>

## 2021 Baseline Water Quality Data

```{r, other notes, include = F}

# ultimately, would like to set up auto query of EPA WQX so this report updates automatically (github actions or other methods...?); eg see front matter guts of https://geocompr.robinlovelace.net/.

```
