% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\title{Kenai River Water Quality Assessment}
\author{Benjamin Meyer, Kenai Watershed Forum}
\date{2022-02-10}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Kenai River Water Quality Assessment},
  pdfauthor={Benjamin Meyer, Kenai Watershed Forum},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{part-part-i}{%
\part{Part I}\label{part-part-i}}

No text here

\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}
\addcontentsline{toc}{chapter}{Preface}

Preface

\hypertarget{acknowledgements}{%
\chapter*{Acknowledgements}\label{acknowledgements}}
\addcontentsline{toc}{chapter}{Acknowledgements}

Acknowledgement

\hypertarget{abstract}{%
\chapter*{Abstract}\label{abstract}}
\addcontentsline{toc}{chapter}{Abstract}

Abstract here

\hypertarget{units}{%
\chapter*{Units}\label{units}}
\addcontentsline{toc}{chapter}{Units}

Units

\hypertarget{acronyms}{%
\chapter*{Acronyms}\label{acronyms}}
\addcontentsline{toc}{chapter}{Acronyms}

Acronyms

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

Introduction/history

\hypertarget{study-area}{%
\chapter{Study Area}\label{study-area}}

\hypertarget{description}{%
\section{Description}\label{description}}

\hypertarget{figuresmaps}{%
\section{Figures/maps}\label{figuresmaps}}

\hypertarget{sampling-sites-descriptionsphotos}{%
\section{Sampling sites descriptions/photos}\label{sampling-sites-descriptionsphotos}}

\hypertarget{tributary-sites}{%
\subsection{Tributary Sites}\label{tributary-sites}}

\hypertarget{main-stem-sites}{%
\subsection{Main Stem Sites}\label{main-stem-sites}}

\hypertarget{part-part-ii}{%
\part{Part II}\label{part-part-ii}}

\hypertarget{methods}{%
\chapter{Methods}\label{methods}}

\hypertarget{results}{%
\chapter{Results}\label{results}}

\hypertarget{parameters-and-graphs}{%
\subsection{Parameters and graphs}\label{parameters-and-graphs}}

Explain how to interpret figures

\hypertarget{parameters}{%
\subsubsection{Parameters}\label{parameters}}

For each parameter, basic time series figures in context of EPA and AEDC limits similar to Guerron Orejuela 2016. Update references and interpretation.

(code note: use ``parameters'' option in front matter of each page to switch, \url{https://bookdown.org/yihui/rmarkdown/params-knit.html})

\hypertarget{data-qaqc}{%
\chapter{Data QA/QC}\label{data-qaqc}}

Data QA/QC report basics

\hypertarget{summary}{%
\chapter{Summary}\label{summary}}

\hypertarget{references}{%
\chapter*{References}\label{references}}
\addcontentsline{toc}{chapter}{References}

List pasted from Zotero library, and link to online library:

\url{https://www.zotero.org/groups/4571804/kenai-river-water-quality-assessment}

\begin{longtable}[]{@{}l@{}}
\toprule
\endhead
author: ``Benjamin Meyer, Kenai Watershed Forum'' \\
date: ``2022-02-10'' \\
output: html\_document: \\
code\_folding: hide \\
\bottomrule
\end{longtable}

\hypertarget{appendix-appendix}{%
\appendix}


\hypertarget{appendix-data-uplift-to-epa-wqx}{%
\chapter{Appendix: Data Uplift to EPA WQX}\label{appendix-data-uplift-to-epa-wqx}}

\hypertarget{introduction-1}{%
\section{Introduction}\label{introduction-1}}

Prior to analysis and interpretation of water quality data, we will ensure that all data that meets QA/QC standards outlined in the project Quality Assurance Project Plan (QAPP) \citep{kenaiwatershedforum2020} is accessible in the appropriate repository. Water quality data for this project is ultimately destined for the EPA Water Quality Exchange (EPA WQX), formerly EPA STORET.

Section B10 of the 2020 QAPP describes data management details and responsible parties for each step of the data pipeline from observation to repository.

\hypertarget{water-quality-data}{%
\subsection{2021 Water Quality Data}\label{water-quality-data}}

Water quality data generated from the Kenai River Baseline Water Quality Monitoring (KRBWQM) program was submitted to the Soldotna office of the Alaska Department of Environmental Conservation (ADEC) in January 2022 using the project-specific AQWMS Template provided by ADEC.

\hypertarget{water-quality-data-aqwms-formatting}{%
\subsubsection{2021 Water Quality Data AQWMS Formatting}\label{water-quality-data-aqwms-formatting}}

The code script below assembles water quality data from the three analytic laboratories that partnered with Kenai Watershed Forum for this project in 2021:

\begin{itemize}
\item
  SGS Laboratories (Anchorage, AK)
\item
  Soldotna Wastewater Treatment Plant (Soldotna, AK)
\item
  Taurianen Engineering (Soldotna, AK)
\end{itemize}

\hypertarget{spring-2021}{%
\paragraph{Spring 2021}\label{spring-2021}}

Download Original Spring 2021 SGS Lab Results Files: (Click Link)

\emph{Click Black Arrow to Show/Hide Code used to Prepare 2021 (Spring \& Summer) SGS Results for AQWMS Template}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# clear environment}
\FunctionTok{rm}\NormalTok{(}\AttributeTok{list=}\FunctionTok{ls}\NormalTok{())}

\CommentTok{\# load packages}
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.6     v dplyr   1.0.7
## v tidyr   1.1.4     v stringr 1.4.0
## v readr   2.1.1     v forcats 0.5.1
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readxl)}
\FunctionTok{library}\NormalTok{(openxlsx)}
\FunctionTok{library}\NormalTok{(data.table)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'data.table'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:dplyr':
## 
##     between, first, last
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     transpose
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(magrittr)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'magrittr'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:purrr':
## 
##     set_names
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:tidyr':
## 
##     extract
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(janitor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'janitor'
\end{verbatim}

\begin{verbatim}
## The following objects are masked from 'package:stats':
## 
##     chisq.test, fisher.test
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Assign 2021 Field Sample Dates }

\CommentTok{\# Spring 2021 sampling date}
\NormalTok{spring21\_sample\_date }\OtherTok{\textless{}{-}} \StringTok{"5/11/2021"}

\CommentTok{\# Summer 2021 Sampling Date}
\NormalTok{summer21\_sample\_date }\OtherTok{\textless{}{-}}\StringTok{"8/27/2021"}

\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Read in  and Clean SGS/ALS Data \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}
\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}


\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Part A: SGS Data Read In \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\DocumentationTok{\#\# Reformat SGS data downloaded from their server client (SGS Engage) to match AQWMS template}

\DocumentationTok{\#\#\# spring 2021 SGS data}

\DocumentationTok{\#\#\#\# read in results downloaded from SGS }
\NormalTok{spring\_sgs21 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/2021\_wqx\_data/spring\_2021\_wqx\_data/SGS/Spring 2021 Results from SGS.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"Report"}\NormalTok{, }\AttributeTok{skip =} \DecValTok{4}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Lab Sample}\StringTok{\textasciigrave{}} \OtherTok{=} \FunctionTok{as.double}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Lab Sample}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# assign field sample date}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sample\_date =}\NormalTok{ spring21\_sample\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{()}

\DocumentationTok{\#\#\# summer 2021 SGS data}

\DocumentationTok{\#\#\#\# read in results downloaded from SGS }
\NormalTok{summer\_sgs21 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/2021\_wqx\_data/summer\_2021\_wqx\_data/SGS/SGS\_results\_Summer2021.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"Report"}\NormalTok{, }\AttributeTok{skip =} \DecValTok{4}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# filter out extraneous info}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\StringTok{\textasciigrave{}}\AttributeTok{Client Sample}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%}\FunctionTok{c}\NormalTok{(}\StringTok{"Sample Comments"}\NormalTok{,}\StringTok{"Client Sample Id"}\NormalTok{),}
         \SpecialCharTok{!}\StringTok{\textasciigrave{}}\AttributeTok{Matrix}\StringTok{\textasciigrave{}} \SpecialCharTok{\%in\%} \StringTok{"200.7 Total Ca, Fe, Mg were analyzed by ALS of Kelso, WA."}\NormalTok{,}
         \SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Lab Sample}\StringTok{\textasciigrave{}}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# remove blank columns}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"..."}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# assign field sample date}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sample\_date =}\NormalTok{ summer21\_sample\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## New names:
## * `` -> ...9
## * `` -> ...10
## * `` -> ...11
## * `` -> ...12
## * `` -> ...13
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# transform column types to prep for join}
\NormalTok{summer\_sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lab\_sample =} \FunctionTok{as.double}\NormalTok{(lab\_sample),}
         \AttributeTok{reporting\_limit =} \FunctionTok{as.double}\NormalTok{(reporting\_limit))}

\CommentTok{\# append spring and summer 2021 results}
\NormalTok{sgs21 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(spring\_sgs21,summer\_sgs21) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# add lab name}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lab\_name =} \StringTok{"SGS North America, Anchorage, Alaska"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# make lab sample column character}
  \FunctionTok{transform}\NormalTok{(}\AttributeTok{lab\_sample =} \FunctionTok{as.character}\NormalTok{(lab\_sample))}

\FunctionTok{rm}\NormalTok{(spring\_sgs21,summer\_sgs21)}






\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Part B: ALS Data Read In \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\DocumentationTok{\#\# SGS subcontracted analyses of Ca, Fe, and Mg to ALS laboratories (Kelso, WA). These results are not included in the spreadsheet download from SGS engage and were entered manually in to seperate spring and summer "ALS" named spreadsheets}

\DocumentationTok{\#\#\#\# read in spring 2021 results from ALS }
\NormalTok{spring\_als21 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/2021\_wqx\_data/spring\_2021\_wqx\_data/SGS/Spring 2021 Total Metals from ALS Lab.xlsx"}\NormalTok{, }\AttributeTok{skip =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# assign field sample date}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sample\_date =}\NormalTok{ spring21\_sample\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{()}

\DocumentationTok{\#\#\#\# read in summer 2021 results from ALS }
\NormalTok{summer\_als21 }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/2021\_wqx\_data/summer\_2021\_wqx\_data/SGS/ALS\_Data\_Results\_Summer\_2021.xlsx"}\NormalTok{, }\AttributeTok{skip =} \DecValTok{5}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# assign field sample date}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sample\_date =}\NormalTok{ summer21\_sample\_date) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{()}

\CommentTok{\# join spring and summer 2021 datasets}
\NormalTok{als21 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(spring\_als21,summer\_als21)}

\CommentTok{\# remove old dataframes}
\FunctionTok{rm}\NormalTok{(spring\_als21,summer\_als21)}

\CommentTok{\# prep ALS data to be joined with SGS data}
\NormalTok{als21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{client\_sample =}\NormalTok{ client\_id,}
         \AttributeTok{lab\_sample =}\NormalTok{ lab\_id,}
         \AttributeTok{reporting\_limit =}\NormalTok{ mrl,}
         \AttributeTok{analysis =}\NormalTok{ method) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{qc1,}\SpecialCharTok{{-}}\NormalTok{data\_entry,}\SpecialCharTok{{-}}\NormalTok{qc2) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# transform column types as needed for join in next step}
  \FunctionTok{transform}\NormalTok{(}\AttributeTok{lab\_sample =} \FunctionTok{as.character}\NormalTok{(lab\_sample),}
            \AttributeTok{analysis =} \FunctionTok{as.character}\NormalTok{(analysis),}
            \AttributeTok{result =} \FunctionTok{as.character}\NormalTok{(result)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# add lab name}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lab\_name =} \StringTok{"ALS Environmental {-} Kelso Laboratory"}\NormalTok{,}
         \CommentTok{\# assign matric type}
         \AttributeTok{matrix =} \StringTok{"Water (Surface, Eff., Ground)"}\NormalTok{)}

\CommentTok{\# join SGS data with ALS data}
\NormalTok{sgs21 }\OtherTok{\textless{}{-}} \FunctionTok{bind\_rows}\NormalTok{(sgs21,als21) }

\FunctionTok{rm}\NormalTok{(als21)}







\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Part C: Address spelling/format issues and inconsistent sample/site names \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\CommentTok{\# upon visual inspection, we can see that the location names in the AQWMS template differ slightly from the place names in the SGS report (spelling and name inconsistencies).}

  
\CommentTok{\# move info about duplicate sample and/or sample blank status into separate column}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sample\_condition =} \FunctionTok{case\_when}\NormalTok{(}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"Blank"}\NormalTok{,client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"Blank"}\NormalTok{,}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"DUP"}\NormalTok{,client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"DUP"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# remove "DUP" designation from client\_sample column}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{str\_replace}\NormalTok{(client\_sample, }\StringTok{"DUP"}\NormalTok{, }\StringTok{""}\NormalTok{)) }

  
\CommentTok{\# remove from "client\_sample" names the text containing the suffixes Diss/Dis (Dissolved metals sample) since we only want a list of unique sites. (Solution for this step found at https://stackoverflow.com/questions/29271549/replace{-}all{-}occurrences{-}of{-}a{-}string{-}in{-}a{-}data{-}frame)}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}  
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =}\NormalTok{ (}\FunctionTok{str\_replace}\NormalTok{(client\_sample, }\StringTok{"Diss|Dis|DUP"}\NormalTok{, }\StringTok{""}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# remove "Diss" suffix and "EP" prefix from "analysis" column}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{analysis =} \FunctionTok{str\_replace}\NormalTok{(analysis, }\StringTok{"Diss"}\NormalTok{, }\StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# note trailing space after "EP200.8 "}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{analysis =} \FunctionTok{str\_replace}\NormalTok{(analysis,}\StringTok{"EP200.8 "}\NormalTok{,}\StringTok{"200.8"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}

  \CommentTok{\# address the one stubborn site name still containing "Diss"}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{    client\_sample }\SpecialCharTok{==} \StringTok{"RM0{-}No Name Creek  Diss"} \SpecialCharTok{\textasciitilde{}} \StringTok{"RM0{-}No Name Creek"}\NormalTok{,}
    \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}}\NormalTok{ client\_sample)) }
  
  
\CommentTok{\# We need to remove white spaces, apostrophes, and dashes. Join functions such as "left\_join" are often uncooperative with these types of strings}
  
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
    \CommentTok{\# remove excess white spaces}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{str\_trim}\NormalTok{(client\_sample,}\StringTok{"both"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{str\_squish}\NormalTok{(client\_sample)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# make remaining white spaces underscores}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{s+"}\NormalTok{,}\StringTok{"\_"}\NormalTok{,client\_sample)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# remove apostrophes}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\textquotesingle{}"}\NormalTok{,}\StringTok{""}\NormalTok{,client\_sample)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# replace dashes with underscores}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{{-}"}\NormalTok{,}\StringTok{"\_"}\NormalTok{,client\_sample)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# replace multiple underscores with single}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_\_"}\NormalTok{,}\StringTok{"\_"}\NormalTok{,client\_sample)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_\_\_"}\NormalTok{,}\StringTok{"\_"}\NormalTok{,client\_sample))}

\CommentTok{\# apply note regarding trip blanks (for BTEX organics)}
\CommentTok{\# assigned in sequence as encountered on chain of custody}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{note =} \FunctionTok{case\_when}\NormalTok{(}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"Trip\_Blank\_1"}\NormalTok{, client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"KWF Crew, RM1.5\_Kenai\_City\_Dock"}\NormalTok{,}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"Trip\_Blank\_2"}\NormalTok{, client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"USFWS Crew, RM6.5\_Cunningham\_Park"}\NormalTok{,}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"Trip\_Blank\_3"}\NormalTok{, client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"DEC Crew, RM40\_Bings\_Landing"}\NormalTok{,}
    \FunctionTok{grepl}\NormalTok{(}\StringTok{"Trip\_Blank\_4"}\NormalTok{, client\_sample) }\SpecialCharTok{\textasciitilde{}} \StringTok{"DEC Crew, RM43\_Upstream\_of\_Dow\_Island"}\NormalTok{))}
  
  
\CommentTok{\# seperate result qualifiers (U, J, B) in to a new column}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{qualifier =} \FunctionTok{str\_extract}\NormalTok{(result,}\StringTok{"[aA{-}zZ]+"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{result =} \FunctionTok{str\_remove}\NormalTok{(result,}\StringTok{"[aA{-}zZ]+"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  
  \CommentTok{\# again replace multiple underscores with single}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{client\_sample =} \FunctionTok{gsub}\NormalTok{(}\StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{\_\_"}\NormalTok{,}\StringTok{"\_"}\NormalTok{,client\_sample)) }







\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\# Part D: Prepare SGS/ALS Location/Site Names \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\CommentTok{\# In preparation for a join to AQWMS table, we will manually generate a match table csv file that we can use }

\DocumentationTok{\#\# generate list of unique site names from 2021 SGS data}
\NormalTok{sgs21\_sitenames }\OtherTok{\textless{}{-}} \FunctionTok{data.table}\NormalTok{(}\FunctionTok{unique}\NormalTok{(sgs21}\SpecialCharTok{$}\NormalTok{client\_sample)) }
  

\CommentTok{\# generate list of unique site names from 2021 AQWMS template}
\NormalTok{aqwms21\_sitenames }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/AQWMS/AWQMS\_KWF\_Baseline\_2021.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"Monitoring Locations"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\StringTok{"Monitoring Location Name"}\NormalTok{, }\StringTok{"Monitoring Location ID"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{distinct}\NormalTok{()}

\CommentTok{\# write 2021 sgs site names to an excel file}
\NormalTok{site\_match\_table\_path }\OtherTok{\textless{}{-}} \StringTok{"other/input/AQWMS/site\_names\_matching\_table.xlsx"}
\FunctionTok{write.xlsx}\NormalTok{(sgs21\_sitenames, site\_match\_table\_path) }

\CommentTok{\# create an excel file with two sheets: a.) SGS site names, and b.) AQWMS site names}
\NormalTok{wb }\OtherTok{\textless{}{-}} \FunctionTok{loadWorkbook}\NormalTok{(site\_match\_table\_path)}
\FunctionTok{addWorksheet}\NormalTok{(wb,}\StringTok{"Sheet2"}\NormalTok{)}
\FunctionTok{writeData}\NormalTok{(wb,}\StringTok{"Sheet2"}\NormalTok{,aqwms21\_sitenames)}
\FunctionTok{saveWorkbook}\NormalTok{(wb,site\_match\_table\_path,}\AttributeTok{overwrite =} \ConstantTok{TRUE}\NormalTok{)}


\CommentTok{\# Using these two tables, we will manually create a new file titled "site\_names\_matching\_table\_manual\_edit.xlsx" and manually match up the two disparate naming systems. Performed by B Meyer January 2022. }


\CommentTok{\# append "Monitoring Location Name" and "Monitoring Location ID" info from WQX to spring 2021 SGS data}

\DocumentationTok{\#\# read in site names join table}
\NormalTok{sitenames21\_match }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/AQWMS/site\_names\_matching\_table\_manual\_edit.xlsx"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\StringTok{\textasciigrave{}}\AttributeTok{Monitoring Location Name}\StringTok{\textasciigrave{}}\NormalTok{,}\StringTok{\textasciigrave{}}\AttributeTok{Monitoring Location ID}\StringTok{\textasciigrave{}}\NormalTok{,sgs\_sitenames) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{client\_sample =}\NormalTok{ sgs\_sitenames)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## New names:
## * `` -> ...4
## * `` -> ...5
## * `` -> ...6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# append monitoring location names}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(sitenames21\_match, }\AttributeTok{by =} \StringTok{"client\_sample"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }

\CommentTok{\# remove}
\FunctionTok{rm}\NormalTok{(sgs21\_sitenames,aqwms21\_sitenames,sitenames21\_match)}






\DocumentationTok{\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# Part E: "Result Analytical Method Context" name rectification \#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#}

\CommentTok{\# In the AQWMS template, the EPA names that will go in the column "Result Analytical Method ID" do not exactly match the names provided by the laboratory (SGS). After communicating with SGS on 2/8/2022, we are able to cross{-}walk between the two naming systems. These matches are documented in the excel file "analysis\_code\_matching\_table.xlsx."}

\CommentTok{\# assign "Result Analytical Method ID" and "Result Analytical Method Context" to dataset using matching table}

\CommentTok{\# read in matching table}
\NormalTok{analysis\_code\_matching\_table }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/AQWMS/analysis\_code\_matching\_table.xlsx"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{Comments,}\SpecialCharTok{{-}}\StringTok{\textasciigrave{}}\AttributeTok{EPA Name}\StringTok{\textasciigrave{}}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{analysis =}\NormalTok{ sgs\_analysis\_code) }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# remove "EP" prefix from method "EP200.8"}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{analysis =} \FunctionTok{str\_replace}\NormalTok{(analysis,}\StringTok{"EP200.8"}\NormalTok{,}\StringTok{"200.8"}\NormalTok{))}
  

\CommentTok{\# read in AQWMS Analytical Methods list}
\NormalTok{aqwms\_analytical\_methods }\OtherTok{\textless{}{-}} \FunctionTok{read\_excel}\NormalTok{(}\StringTok{"other/input/AQWMS/AWQMS\_KWF\_Baseline\_2021.xlsx"}\NormalTok{, }\AttributeTok{sheet =} \StringTok{"Analytical Methods"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\StringTok{"ID"}\NormalTok{,}\StringTok{"Context Code"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename}\NormalTok{(}\AttributeTok{epa\_analysis\_id =}\NormalTok{ id) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i = sheet, :
## Expecting logical in F1126 / R1126C6: got '4500-NO2'
\end{verbatim}

\begin{verbatim}
## Warning in read_fun(path = enc2native(normalizePath(path)), sheet_i = sheet, :
## Expecting logical in F1130 / R1130C6: got '4500-NO3'
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# join two tables above}
\NormalTok{epa\_analysis\_codes }\OtherTok{\textless{}{-}} \FunctionTok{inner\_join}\NormalTok{(aqwms\_analytical\_methods,analysis\_code\_matching\_table, }\AttributeTok{by =} \StringTok{"epa\_analysis\_id"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\NormalTok{context\_code }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"USEPA Rev 5.4"}\NormalTok{,}
                              \StringTok{"APHA (1997)"}\NormalTok{,}
                              \StringTok{"APHA (1999)"}\NormalTok{)) }

\CommentTok{\# join EPA analysis IDs and context codes to overall dataset}
\NormalTok{sgs21 }\SpecialCharTok{\%\textless{}\textgreater{}\%}
  \FunctionTok{left\_join}\NormalTok{(epa\_analysis\_codes, }\AttributeTok{by =} \StringTok{"analysis"}\NormalTok{)}

\CommentTok{\#"EP200.8 Diss" remains in analysis column, wth ...}

\FunctionTok{rm}\NormalTok{(analysis\_code\_matching\_table,aqwms\_analytical\_methods,epa\_analysis\_codes)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Taurianen data}
\DocumentationTok{\#\# Reformat Taurianen data to match AQWMS template}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Soldotna Wastewater Treatment Plant}
\DocumentationTok{\#\# Reformat SWWTP data to match AQWMS template}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# check out example from other WQP download}
\NormalTok{z1 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"other/input/wqp\_data/narrowresult.csv"}\NormalTok{)}

\DocumentationTok{\#\#\# 1st step:::: make sure that monitoring list locations matches those currently match those in DEC AQWMS database (AWQMS public login: https://awqms2.goldsystems.com/Login.aspx, username akpublic, no password)}
\end{Highlighting}
\end{Shaded}

\hypertarget{baseline-water-quality-data}{%
\section{2021 Baseline Water Quality Data}\label{baseline-water-quality-data}}

  \bibliography{book.bib,packages.bib}

\end{document}
